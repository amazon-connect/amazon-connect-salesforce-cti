"use strict";(self.webpackChunkamazon_connect_salesforce_cti=self.webpackChunkamazon_connect_salesforce_cti||[]).push([[2707],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>g});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},m=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},k=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),k=p(a),g=r,u=k["".concat(s,".").concat(g)]||k[g]||c[g]||o;return a?n.createElement(u,i(i({ref:t},m),{},{components:a})):n.createElement(u,i({ref:t},m))}));function g(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=k;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},315:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>k,frontMatter:()=>i,metadata:()=>s,toc:()=>m});var n=a(7462),r=(a(7294),a(3905)),o=a(4996);const i={id:"04-salesforce-lambdas-manual-setup",title:"Setting Up The Salesforce Lambdas Manually"},l=void 0,s={unversionedId:"lightning/installation/04-salesforce-lambdas-manual-setup",id:"lightning/installation/04-salesforce-lambdas-manual-setup",title:"Setting Up The Salesforce Lambdas Manually",description:"Below are manual setup instructions for the Salesforce Lambdas.",source:"@site/docs/lightning/02-installation/04-salesforce-lambdas-manual-setup.md",sourceDirName:"lightning/02-installation",slug:"/lightning/installation/04-salesforce-lambdas-manual-setup",permalink:"/amazon-connect-salesforce-cti/docs/lightning/installation/04-salesforce-lambdas-manual-setup",draft:!1,editUrl:"https://github.com/amazon-connect/amazon-connect-salesforce-cti/docs/lightning/02-installation/04-salesforce-lambdas-manual-setup.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{id:"04-salesforce-lambdas-manual-setup",title:"Setting Up The Salesforce Lambdas Manually"},sidebar:"lightning",previous:{title:"Setting Up The CTI Adapter Managed Package Manually",permalink:"/amazon-connect-salesforce-cti/docs/lightning/installation/03-managed-package-manual-setup"},next:{title:"Upgrading from an Earlier Version",permalink:"/amazon-connect-salesforce-cti/docs/lightning/installation/05-upgrading-from-an-earlier-version"}},p={},m=[{value:"Prerequisite Configuration and Data Collection",id:"prerequisite-configuration-and-data-collection",level:2},{value:"Check your Salesforce API Version",id:"check-your-salesforce-api-version",level:3},{value:"Create a New Connected App",id:"create-a-new-connected-app",level:4},{value:"Create a new API user",id:"create-a-new-api-user",level:3},{value:"Allowing the API user to authenticate using password",id:"allowing-the-api-user-to-authenticate-using-password",level:4},{value:"Gather Amazon Connect information",id:"gather-amazon-connect-information",level:3},{value:"Store Salesforce Credentials in AWS Secrets Manager",id:"store-salesforce-credentials-in-aws-secrets-manager",level:4},{value:"Install the Amazon Connect Salesforce Lambda package",id:"install-the-amazon-connect-salesforce-lambda-package",level:2},{value:"Compatibility Table",id:"compatibility-table",level:3},{value:"Instructions",id:"instructions",level:4},{value:"Test the Core Functionality",id:"test-the-core-functionality",level:3},{value:"Validate the core functionality",id:"validate-the-core-functionality",level:4},{value:"Allow Amazon Connect to Access the sfInvokeAPI Lambda Function",id:"allow-amazon-connect-to-access-the-sfinvokeapi-lambda-function",level:3},{value:"Add the Lambda function to your Amazon Connect instance",id:"add-the-lambda-function-to-your-amazon-connect-instance",level:4}],c={toc:m};function k(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Below are manual setup instructions for the Salesforce Lambdas."),(0,r.kt)("h2",{id:"prerequisite-configuration-and-data-collection"},"Prerequisite Configuration and Data Collection"),(0,r.kt)("p",null,"In order to successfully deploy and utilize the functions in the Amazon\nConnect Salesforce Lambda package, you will need to validate and\nconfigure some items in your Salesforce Org and gather some information\nfrom your Amazon Connect instance."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Check your Salesforce API version")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Create a new Connected App")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Create a new API user")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Gather Amazon Connect information"))),(0,r.kt)("p",null,"As you are preparing to deploy the package, it is a good idea to open a\ntext editor and note information as you configure the environment. We\nwill point out the items you will need to provide."),(0,r.kt)("h3",{id:"check-your-salesforce-api-version"},"Check your Salesforce API Version"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Log in into your Salesforce org and go to ",(0,r.kt)("strong",{parentName:"p"},"Setup"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the ",(0,r.kt)("strong",{parentName:"p"},"Quick Find")," field, type ",(0,r.kt)("strong",{parentName:"p"},"apex"),", then select ",(0,r.kt)("strong",{parentName:"p"},"Apex\nClasses")," from the results"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image56.png")}),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Select New")),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image57.png")}),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Select the Version Settings tab")),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image58.png")}),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"Note the Salesforce.com API version in your notepad. The pattern of this value is ",(0,r.kt)("inlineCode",{parentName:"li"},"vXX.X"),".")),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image59.png")}),(0,r.kt)("h4",{id:"create-a-new-connected-app"},"Create a New Connected App"),(0,r.kt)("p",null,"To leverage the full potential of the integration, Salesforce data needs\nto be accessed from AWS environment. The package comes with a set of\npre-built AWS Lambda functions to lookup, update and create Salesforce\nobjects within Amazon Connect Contact Flows. These Lambda function\naccess Salesforce using the Salesforce REST API."),(0,r.kt)("p",null,"To get access to the environment, a Connected App must be configured\nwith OAuth settings enabled."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Log in into your Salesforce org and go to ",(0,r.kt)("strong",{parentName:"p"},"Setup"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the ",(0,r.kt)("strong",{parentName:"p"},"Quick Find")," field, type ",(0,r.kt)("strong",{parentName:"p"},"app manager"),", then select ",(0,r.kt)("strong",{parentName:"p"},"App\nManager")," from the results")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the upper right corner, select ",(0,r.kt)("strong",{parentName:"p"},"New Connected App")))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image60.png")}),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"On the New Connected App form, enter a name for the Connected App,\nsuch as ",(0,r.kt)("strong",{parentName:"li"},"Amazon Connect Integration")," and press tab. This will\npopulate the API Name automatically. Then provide a contact email\naddress")),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image61.png")}),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"Select the checkbox to ",(0,r.kt)("strong",{parentName:"li"},"Enable OAuth Settings"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image62.png")}),(0,r.kt)("ol",{start:6},(0,r.kt)("li",{parentName:"ol"},"Set the ",(0,r.kt)("strong",{parentName:"li"},"Callback URL")," to your domain url. Find the domain at ",(0,r.kt)("em",{parentName:"li"},"Setup")," -> ",(0,r.kt)("em",{parentName:"li"},"My Domain"),".")),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image293.png")}),(0,r.kt)("ol",{start:7},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the Selected OAuth Scopes section, select the following and add\nthem to the Selected OAuth Scopes:")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Access the identity URL service (id, profile, email, address, phone)")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Manage user data via APIs (api)")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the checkbox for Require Secret for Web Server Flow, and the checkbox for Require Secret For Refresh Token Flow")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The ",(0,r.kt)("strong",{parentName:"p"},"API (Enable OAuth Settings)")," section should now look like\nthis"))),(0,r.kt)("img",{src:(0,o.Z)("/img/shared/guidedsetup4.png")}),(0,r.kt)("ol",{start:12},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Save")," at the bottom of the screen.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Continue")," on the New Connected App page")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"You should now be at the new app's page")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Copy the value for ",(0,r.kt)("strong",{parentName:"p"},"Consumer Key")," to your notepad")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Click to reveal")," next to Consumer Secret and copy the\nvalue to your notepad")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"At the top of the detail page, select ",(0,r.kt)("strong",{parentName:"p"},"Manage"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"On the Connected App Detail page, select the ",(0,r.kt)("strong",{parentName:"p"},"Edit Policies"),"\nbutton")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Set Permitted Users to ",(0,r.kt)("strong",{parentName:"p"},"Admin approved users are pre-authorized"),"\nand choose OK on the pop-up dialog")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Set IP Relaxation to ",(0,r.kt)("strong",{parentName:"p"},"Relax IP restrictions"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The OAuth Policies section should now look like the following"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image65.png")}),(0,r.kt)("ol",{start:22},(0,r.kt)("li",{parentName:"ol"},"Select ",(0,r.kt)("strong",{parentName:"li"},"Save"))),(0,r.kt)("h3",{id:"create-a-new-api-user"},"Create a new API user"),(0,r.kt)("p",null,"The Lambda functions authenticate with Salesforce via user credentials.\nIt is a common practice to create an API user account for this purpose."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Log in into your Salesforce org and go to ",(0,r.kt)("strong",{parentName:"p"},"Setup"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the ",(0,r.kt)("strong",{parentName:"p"},"Quick Find")," field, type ",(0,r.kt)("strong",{parentName:"p"},"profiles"),", then select\n",(0,r.kt)("strong",{parentName:"p"},"Profiles")," from the results")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select New Profile"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image66.png")}),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Provide a Profile Name, such as ",(0,r.kt)("strong",{parentName:"p"},"API_ONLY"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"From the ",(0,r.kt)("strong",{parentName:"p"},"Existing Profile")," dropdown, select ",(0,r.kt)("strong",{parentName:"p"},"System Administrator"),"\n",(0,r.kt)("strong",{parentName:"p"},"NOTE:")," You\\'re advised to use a full Salesforce License for the\nuser to be able to set the below permissions and have full access to\navoid any other errors."))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image67.png")}),(0,r.kt)("ol",{start:6},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Save")," to create the new profile")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Once the new profile page opens, scroll down to and select the ",(0,r.kt)("strong",{parentName:"p"},"System Permissions")," section"))),(0,r.kt)("img",{src:(0,o.Z)("/img/shared/usersetup1.png")}),(0,r.kt)("ol",{start:8},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"When the next page opens, select ",(0,r.kt)("strong",{parentName:"p"},"edit"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Make sure the ",(0,r.kt)("strong",{parentName:"p"},"Lightning Experience User")," option is unselected"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image290.png")}),(0,r.kt)("ol",{start:10},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Save"),", and confirm the changes")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Go back to the Profile Overview, scroll down, and select ",(0,r.kt)("strong",{parentName:"p"},"Password Policies")))),(0,r.kt)("img",{src:(0,o.Z)("/img/shared/usersetup2.png")}),(0,r.kt)("ol",{start:12},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Edit"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Set ",(0,r.kt)("strong",{parentName:"p"},"User passwords expire in")," to ",(0,r.kt)("strong",{parentName:"p"},"Never expires")," NOTE: Failure to this may lead to production outages.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Save"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the ",(0,r.kt)("strong",{parentName:"p"},"Quick Find")," field, type ",(0,r.kt)("strong",{parentName:"p"},"connect"),", then select ",(0,r.kt)("strong",{parentName:"p"},"Manage\nConnected Apps")," from the results"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image69.png")}),(0,r.kt)("ol",{start:16},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the app you have created earlier, ",(0,r.kt)("strong",{parentName:"p"},"Amazon Connect\nIntegration"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the profiles section, select ",(0,r.kt)("strong",{parentName:"p"},"Manage Profiles"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the new ",(0,r.kt)("strong",{parentName:"p"},"API_Only")," profile that you just created")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Save")," at the bottom of the page")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the ",(0,r.kt)("strong",{parentName:"p"},"Quick Find")," field, type ",(0,r.kt)("strong",{parentName:"p"},"users")," then select ",(0,r.kt)("strong",{parentName:"p"},"Users"),"\nfrom the results")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select New User")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Set the required fields as:"),(0,r.kt)("p",{parentName:"li"},"a.  Last Name: apiuser"),(0,r.kt)("p",{parentName:"li"},"b.  Alias: apiuser"),(0,r.kt)("p",{parentName:"li"},"c.  Email: provide a valid email address"),(0,r.kt)("p",{parentName:"li"},"d.  Username: apiuser@<yoursalesforcedomain",">",".com"),(0,r.kt)("p",{parentName:"li"},"e.  Nickname: apiuser")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"On the right-hand side, set ",(0,r.kt)("strong",{parentName:"p"},"User License")," to ",(0,r.kt)("strong",{parentName:"p"},"Salesforce"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Set Profile to API_ONLY")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Choose ",(0,r.kt)("strong",{parentName:"p"},"Save"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In ",(0,r.kt)("strong",{parentName:"p"},"Quick Find"),', search for "Permission Sets". Select the ',(0,r.kt)("strong",{parentName:"p"},"AC_Administrator")," permission set."))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/lambda-install-0.png")}),(0,r.kt)("ol",{start:27},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Manage Assignments"),". Add the apiuser you just created to the permission set.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"A confirmation email with an ",(0,r.kt)("strong",{parentName:"p"},"activation link")," will be sent to the\nemail address provided. Choose the link to activate your user and\nset their password")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Fill out the form to set a password for the API user")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Change Password"),". The API user will log into the\nSalesforce Classic view")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Access the API user's personal settings by selecting the username in\nthe top right corner, then choose ",(0,r.kt)("strong",{parentName:"p"},"My Settings")))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image70.png")}),(0,r.kt)("ol",{start:32},(0,r.kt)("li",{parentName:"ol"},"In the ",(0,r.kt)("strong",{parentName:"li"},"Quick Find")," field, type ",(0,r.kt)("strong",{parentName:"li"},"security")," then select ",(0,r.kt)("strong",{parentName:"li"},"Reset\nMy Security Token")," from the results")),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image71.png")}),(0,r.kt)("ol",{start:33},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Reset Security Token"),". Your security token will be emailed\nto you")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Copy the security token from the email to your notepad"))),(0,r.kt)("h4",{id:"allowing-the-api-user-to-authenticate-using-password"},"Allowing the API user to authenticate using password"),(0,r.kt)("p",null,"The api user created above authenticates using username-password flow in Salesforce. This flow needs to be unblocked and to do that, go to ",(0,r.kt)("em",{parentName:"p"},"Setup")," and in the Quick Find box, search for ",(0,r.kt)("strong",{parentName:"p"},"OAuth and OpenID Connect Settings"),". After that, make sure that the toggles for ",(0,r.kt)("strong",{parentName:"p"},"Allow OAuth Username-Password Flows")," and ",(0,r.kt)("strong",{parentName:"p"},"Allow OAuth User-Agent Flows")," are turned ON, as shown in below image."),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image292.png")}),(0,r.kt)("h3",{id:"gather-amazon-connect-information"},"Gather Amazon Connect information"),(0,r.kt)("p",null,"The last thing to do before you can install the Amazon Connect\nSalesforce Lambda Package is gather some details about your Amazon\nConnect instance. These will be used during the package installation."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In a new browser tab, login to the ",(0,r.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/"},(0,r.kt)("strong",{parentName:"a"},"AWS\nconsole")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Navigate to the ",(0,r.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/connect/home"},"Amazon Connect\nConsole"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select your Instance Alias")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"On the Overview page for your instance, copy the string following\ninstance/ in the Instance ARN and paste it to your notepad. This is\nyour Instance ID."))),(0,r.kt)("img",{src:(0,o.Z)("/img/shared/image05.png")}),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the left nav, select ",(0,r.kt)("strong",{parentName:"p"},"Data storage"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"On the ",(0,r.kt)("strong",{parentName:"p"},"Data storage")," page, copy the S3 bucket names for your Call\nrecordings and Exported Reports. The bucket name is everything\npreceding the first / in the XX will be stored here sections"))),(0,r.kt)("img",{src:(0,o.Z)("/img/shared/image06.png")}),(0,r.kt)("ol",{start:7},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the left nav, select ",(0,r.kt)("strong",{parentName:"p"},"Data streaming"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Note the name of the Kinesis stream configured in the Contact Trace\nRecords section, then select ",(0,r.kt)("strong",{parentName:"p"},"Create a new Kinesis Stream"),". This\nwill take you to the list of Kinesis streams configured in this\nregion.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the ",(0,r.kt)("strong",{parentName:"p"},"Kinesis stream name")," that matches what was configured\nin the previous step")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"On the stream detail page, copy the entire value for Stream ARN"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image74.png")}),(0,r.kt)("h4",{id:"store-salesforce-credentials-in-aws-secrets-manager"},"Store Salesforce Credentials in AWS Secrets Manager"),(0,r.kt)("p",null,"To ensure that your Salesforce credentials are secure, the Lambdas\nrequire that the credentials are stored in AWS Secrets Manager. AWS\nSecrets Manager is a highly secure service that helps you store and\nretrieve secrets."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In a new browser tab, login to the AWS console")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Make sure you are in the same region as your Amazon Connect\ninstance. You can set the region by expanding the region selector in\nthe upper right and choosing the region"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image75.png")}),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Navigate to the ",(0,r.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/secretsmanager/home"},"Secrets Manager\nconsole"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Secrets"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Store a new secret"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Other types of secrets"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Make sure ",(0,r.kt)("strong",{parentName:"p"},"Secret key/value")," is selected")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Enter key value pairs that match the following:"),(0,r.kt)("p",{parentName:"li"},"a.  ",(0,r.kt)("strong",{parentName:"p"},"Key:")," Password, ",(0,r.kt)("strong",{parentName:"p"},"Value:")," the password for the API user that\nyou configured in the previous section"),(0,r.kt)("p",{parentName:"li"},"b.  ",(0,r.kt)("strong",{parentName:"p"},"Key:")," ConsumerKey, ",(0,r.kt)("strong",{parentName:"p"},"Value:")," the Consumer Key for the\nConnected App you created in the previous section"),(0,r.kt)("p",{parentName:"li"},"c.  ",(0,r.kt)("strong",{parentName:"p"},"Key:")," ConsumerSecret, ",(0,r.kt)("strong",{parentName:"p"},"Value:")," the Consumer Secret for the\nConnected App you created in the previous section"),(0,r.kt)("p",{parentName:"li"},"d.  ",(0,r.kt)("strong",{parentName:"p"},"Key:")," AccessToken, ",(0,r.kt)("strong",{parentName:"p"},"Value:")," this is the access token for\nthe API user that you configured in the previous section")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"For the encryption key, click ",(0,r.kt)("strong",{parentName:"p"},"Add new key"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Create Key"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Make sure key type is set to ",(0,r.kt)("strong",{parentName:"p"},"symmetric"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Give your key an ",(0,r.kt)("strong",{parentName:"p"},"alias"),", like\n",(0,r.kt)("em",{parentName:"p"},"SalesforceCredentialsSecretsManagerKey"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click Next")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select administrators you want to have access permission to change\nthe key policy. Make sure you are being as restrictive as possible")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click Next")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the users and roles you want to have access to the Salesforce\ncredentials in Secrets Manager. Make sure you are being as\nrestrictive as possible")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click Next")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click Finish")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click on the managed key that you just created (which is\n",(0,r.kt)("em",{parentName:"p"},"SalesforceCredentialsSecretsManagerKey")," in this case).")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Note down the ARN. This is SalesforceCredentialsKMSKeyARN that will\nbe used later when installing the Amazon Connect Salesforce Lambda\npackage.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Navigate back to the Secrets Manager setup tab")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the key you just created"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image76.png")}),(0,r.kt)("ol",{start:23},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click Next")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Give your secret a name, like ",(0,r.kt)("em",{parentName:"p"},"SalesforceCredentials"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click Next")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Make sure ",(0,r.kt)("strong",{parentName:"p"},"automatic rotation")," is disabled.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click Next")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click Store")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the secret you just created, and copy the Secret ARN"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image77.png")}),(0,r.kt)("ol",{start:30},(0,r.kt)("li",{parentName:"ol"},"You should now have all of the information you need to install the\npackage")),(0,r.kt)("h2",{id:"install-the-amazon-connect-salesforce-lambda-package"},"Install the Amazon Connect Salesforce Lambda package"),(0,r.kt)("h3",{id:"compatibility-table"},"Compatibility Table"),(0,r.kt)("p",null,"The following table instructs users on the best CTI Adapter version to\nuse with the corresponding lambda version. If a minor version for the CTI Adapter is not\nlisted (ex. v5.21.1), it will be grouped with with its major version unless otherwise specified"),(0,r.kt)("table",null,(0,r.kt)("tr",null,(0,r.kt)("th",null,"CTI Adapter Version"),(0,r.kt)("th",null,"Lambda Version")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.24"),(0,r.kt)("td",null,"v5.22")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.23.3"),(0,r.kt)("td",null,"v5.22")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.22"),(0,r.kt)("td",null,"v5.22")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.21"),(0,r.kt)("td",null,"v5.19 - v5.19.7")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.20"),(0,r.kt)("td",null,"v5.19 - v5.19.7")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.19"),(0,r.kt)("td",null,"v5.19 - v5.19.7")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.18"),(0,r.kt)("td",null,"v5.18")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.17"),(0,r.kt)("td",null,"v5.17")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.16"),(0,r.kt)("td",null,"v5.16")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.15"),(0,r.kt)("td",null,"v5.15")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.14"),(0,r.kt)("td",null,"v5.14")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.13"),(0,r.kt)("td",null,"v5.13")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.12"),(0,r.kt)("td",null,"v5.11 - v5.12")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.11"),(0,r.kt)("td",null,"v5.11 - v5.12")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.10"),(0,r.kt)("td",null,"v5.10")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.9"),(0,r.kt)("td",null,"v5.9")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.7"),(0,r.kt)("td",null,"v5.7 - v5.8")),(0,r.kt)("tr",null,(0,r.kt)("td",null,"v5.6"),(0,r.kt)("td",null,"v5.7 - v5.8"))),(0,r.kt)("h4",{id:"instructions"},"Instructions"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In a new browser tab, login to the ",(0,r.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/"},"AWS\nconsole"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Make sure you are in the same region as your Amazon Connect instance")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Once you have selected the region, navigate to the ",(0,r.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/connect/home"},"Amazon Connect\nConsole"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Verify that the Amazon Connect instance that you wish to configure\nis listed")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Once you have verified your Amazon Connect instance, Open the\n",(0,r.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/serverlessrepo/home"},"Serverless Application Repository\nConsole"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the left navigation, select ",(0,r.kt)("strong",{parentName:"p"},"Available Applications")))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image78.png")}),(0,r.kt)("ol",{start:7},(0,r.kt)("li",{parentName:"ol"},"In the search area, make sure that ",(0,r.kt)("strong",{parentName:"li"},"Public applications")," is\nselected, check the box for ",(0,r.kt)("strong",{parentName:"li"},"Show apps that create custom IAM roles\nor resource policies"),", and enter ",(0,r.kt)("strong",{parentName:"li"},"Salesforce")," in the search\nfield, this will automatically filter the available packages")),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image79.png")}),(0,r.kt)("ol",{start:8},(0,r.kt)("li",{parentName:"ol"},"Select AmazonConnectSalesForceLambda")),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image80.png")}),(0,r.kt)("ol",{start:9},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"When the Application loads, scroll down to the ",(0,r.kt)("strong",{parentName:"p"},"Application\nsettings")," section")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Fill in the parameters using the data you gathered in your notepad\nin the previous section using the following notes:"),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Application name:")," You can accept the default here or change\nit as desired")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"AmazonConnectInstanceId:")," You Amazon Connect Instance Id.\nOnly required if you enable real time reporting")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"CTRKinesisARN:")," This is the ARN for the Kinesis stream that\nwas configured for Contact Trace Record streaming in Amazon\nConnect. This is the complete ARN. Amazon Kinesis Firehose is\nnot supported.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"ConnectReportingS3BucketName:")," This is the name of the S3\nbucket used to store exported reports for your Amazon Connect\ninstance. This is ONLY the bucket name, no sub-folders or\nsuffixes")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"HistoricalReportingImportEnabled:")," true ","|"," false - if set to\ntrue, the package will include a feature to import Amazon\nConnect Queue and Agent Historical Metrics into your Salesforce\nOrg. This feature requires you to provide\n",(0,r.kt)("strong",{parentName:"p"},"ConnectReportingS3BucketName"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"LambdaLoggingLevel:")," DEBUG ","|"," INFO ","|"," WARNING ","|"," ERROR ","|","\nCRITICAL - Logging level for Lambda functions")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"PrivateVpcEnabled:")," Set to true if functions should be\ndeployed to a private VPC. Set VpcSecurityGroupList and\nVpcSubnetList if this is set to true.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"RealtimeReportingImportEnabled:")," true ","|"," false - if set to\ntrue, the package will include a feature to publish Amazon\nConnect Queue Metrics into your Salesforce Org. This feature\nrequires you to provide ",(0,r.kt)("strong",{parentName:"p"},"AmazonConnectInstanceId"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"SalesforceAdapterNamespace:")," This is the namespace for CTI\nAdapter managed package. The default value is ",(0,r.kt)("strong",{parentName:"p"},"amazonconnect"),".\nIf a non-managed package is used, leave this field blank.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"SalesforceCredentialsKMSKeyARN:")," This is the ARN for KMS\ncustomer managed key that you created in the previous section.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"SalesforceCredentialsSecretsManagerARN:")," This is the ARN for\nthe Secrets Manager Secret that you created in the previous\nsection.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"SalesforceHost:")," The full domain for your salesforce org. For\nexample\n",(0,r.kt)("inlineCode",{parentName:"p"},"https://mydevorg-dev-ed.my.salesforce.com"),".\nPlease make sure that the host starts with ",(0,r.kt)("inlineCode",{parentName:"p"},"https"),", and that the url\nends with ",(0,r.kt)("inlineCode",{parentName:"p"},".my.salesforce.com"),". This url can be found in ",(0,r.kt)("inlineCode",{parentName:"p"},"Setup")," -> ",(0,r.kt)("inlineCode",{parentName:"p"},"My Domain"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"SalesforceProduction:")," true ","|"," false - True for Production\nEnvironment, False for Sandbox")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"SalesforceUsername:")," The username for the API user that you\nconfigured in the previous section. Salesforce usernames are in the form of an email address.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"SalesforceVersion:")," This is the Salesforce.com API version\nthat you noted in the previous section. The pattern of this value is ",(0,r.kt)("inlineCode",{parentName:"p"},"vXX.X"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"TranscribeOutputS3BucketName:")," This is the S3 bucket where\nAmazon Transcribe stores the output. Typically, this is the same\nbucket that call recordings are stored in, so you can use the\nsame value as found in ",(0,r.kt)("strong",{parentName:"p"},"ConnectRecordingS3BucketName"),". Not\nrequired if PostcallRecordingImportEnabled,\nPostcallTranscribeEnabled, ContactLensImportEnabled set to false.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"VpcSecurityGroupList:")," The list of SecurityGroupIds for\nVirtual Private Cloud (VPC). Not required if PrivateVpcEnabled\nis set to false.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"VpcSubnetList:")," The list of Subnets for the Virtual Private\nCloud (VPC). Not required if PrivateVpcEnabled is set to false.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"AmazonConnectQueueMaxRecords:")," Enter record set size for list\nqueue query. Max is 100.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"AmazonConnectQueueMetricsMaxRecords:")," Enter record set size\nfor queue metrics query. Max is 100.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"CTREventSourceMappingMaximumRetryAttempts:")," Maximum retry\nattempts on failure for lambdas triggered by Kinesis Events.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"ConnectRecordingS3BucketName:")," This is the name of the S3\nbucket used to store recordings for your Amazon Connect\ninstance. This is ONLY the bucket name, no sub-folders or\nsuffixes")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"ContactLensImportEnabled:")," true ","|"," false - Set to false if\nimporting Contact Lens into Salesforce should not be enabled.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"PostcallCTRImportEnabled:")," true ","|"," false - Set to false if\nimporting CTRs into Salesforce should not be enabled on the\npackage level. This setting can be disabled on a call-by-call\nbasis.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"PostcallRecordingImportEnabled:")," true ","|"," false - Set to false\nif importing call recordings into Salesforce should not be\nenabled on the package level. This setting can be disabled on a\ncall-by-call basis.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"PostcallTranscribeEnabled:")," true ","|"," false - Set to false if\npost-call transcription should not be enabled on the package\nlevel. This setting can be disabled on a call-by-call basis.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"TranscriptionJobCheckWaitTime:")," Time between transcription\njob checks")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Once you have completed the form, select ",(0,r.kt)("strong",{parentName:"p"},"Deploy"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Deployment will take some time, with status updates being provided\nby the UI. Once it has completely deployed, you will receive a\nnotification on the screen"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image81.png")}),(0,r.kt)("h3",{id:"test-the-core-functionality"},"Test the Core Functionality"),(0,r.kt)("p",null,"The package provides a core Lambda function (sfInvokeAPI) that supports\nmultiple operations, like lookup, create and update. For the initial\nvalidation, sample events are provided within the function. Validating\nthis function provides a good check that the installation and\nconfiguration is correct."),(0,r.kt)("p",null,"Validating the lambda functions requires the use of test events to\nsimulate data coming into the function as it would in a typical\ndeployment. Each function has a set of test event samples included to\nmake validation easier."),(0,r.kt)("h4",{id:"validate-the-core-functionality"},"Validate the core functionality"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In a new browser tab, login to the ",(0,r.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/"},(0,r.kt)("strong",{parentName:"a"},"AWS\nconsole")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Open the ",(0,r.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/lambda/home"},"AWS Lambda\nConsole"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the Filter field, enter sfInvokeAPI and press enter, this will\nfilter your list out to the core function that we just installed"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image82.png")}),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the ",(0,r.kt)("strong",{parentName:"p"},"function name.")," First, we will validate a phone number\nlookup.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the Environment pane, double-click the event-phoneLookup.json\nfile"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image83.png")}),(0,r.kt)("ol",{start:6},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The test even JSON will open in the Lambda editor")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Modify the value for sf_phone to match the phone number of the test\ncontact you created when you setup the CTI adapter or for any valid\ncontact in your Salesforce org\\\nNOTE: The phone number must be in ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/connect/latest/adminguide/amazon-connect-contact-control-panel.html#international-calls-ccp"},"E.164\nformat")))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image84.png")}),(0,r.kt)("ol",{start:8},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the entire JSON event and copy it, then close the\n",(0,r.kt)("strong",{parentName:"p"},"event-phoneLookup.json")," tab.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the top-right corner, select drop-down arrow next to ",(0,r.kt)("strong",{parentName:"p"},"Test")," and\nchoose ",(0,r.kt)("strong",{parentName:"p"},"Configure test events")))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image85.png")}),(0,r.kt)("ol",{start:10},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the radio button for ",(0,r.kt)("strong",{parentName:"p"},"Create new test event")," and provide an\nevent name, for example: ",(0,r.kt)("strong",{parentName:"p"},"phoneLookup"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the existing event JSON and ",(0,r.kt)("strong",{parentName:"p"},"delete")," it. Paste the modified\nJSON payload you copied from the ",(0,r.kt)("strong",{parentName:"p"},"event-phoneLookup.json")," file"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image86.png")}),(0,r.kt)("ol",{start:12},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Create")," to save your test event")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"By default, your new test event should be selected in the drop-down\nlist to the left of the Test button."))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image87.png")}),(0,r.kt)("ol",{start:14},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Test"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},'If successful, the result will contain fields defined in "sf_fields"\nparameter in the invocation event'))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image88.png")}),(0,r.kt)("ol",{start:16},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Copy the value for the ",(0,r.kt)("strong",{parentName:"p"},"Id")," key in the response. Next, we are\ngoing to use that Id to create a Case in Salesforce.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the Environment pane, double-click the ",(0,r.kt)("strong",{parentName:"p"},"event-create.json"),"\nfile. Replace the existing ContactId value with the ID value you\ncopied previously."))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image89.png")}),(0,r.kt)("ol",{start:18},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the entire JSON event and copy it, then close the\n",(0,r.kt)("strong",{parentName:"p"},"event-create.json")," tab.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the top-right corner, select drop-down arrow next to ",(0,r.kt)("strong",{parentName:"p"},"Test")," and\nchoose ",(0,r.kt)("strong",{parentName:"p"},"Configure test events")))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image90.png")}),(0,r.kt)("ol",{start:20},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the radio button for ",(0,r.kt)("strong",{parentName:"p"},"Create new test event")," and provide an\nevent name, for example: ",(0,r.kt)("strong",{parentName:"p"},"createCase"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the existing event JSON and ",(0,r.kt)("strong",{parentName:"p"},"delete")," it. Paste the modified\nJSON payload you copied from the ",(0,r.kt)("strong",{parentName:"p"},"event-create.json")," file"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image91.png")}),(0,r.kt)("ol",{start:22},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Create")," to save your test event")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"By default, your new test event should be selected in the drop-down\nlist to the left of the Test button."))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image92.png")}),(0,r.kt)("ol",{start:24},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Test"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"If successful, the result will contain the Case Id"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image93.png")}),(0,r.kt)("ol",{start:26},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Copy the value for the ",(0,r.kt)("strong",{parentName:"p"},"Id")," key in the response.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"When we created the case, the ",(0,r.kt)("strong",{parentName:"p"},"Status was set to New")," and the\n",(0,r.kt)("strong",{parentName:"p"},"Priority to Low"),". We are going to use the update operation to\nclose the case.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the Environment pane, double-click the ",(0,r.kt)("strong",{parentName:"p"},"event-update.json"),' file\nand replace the existing Case Id in "sf_id" parameter with the new\none you copied from the last test result'))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image94.png")}),(0,r.kt)("ol",{start:29},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the ",(0,r.kt)("strong",{parentName:"p"},"entire JSON event")," and copy it, then close the\n",(0,r.kt)("strong",{parentName:"p"},"event-update.json")," tab.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the top-right corner, select drop-down arrow next to ",(0,r.kt)("strong",{parentName:"p"},"Test")," and\nchoose **Configure test events"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image95.png")}),(0,r.kt)("ol",{start:31},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the radio button for ",(0,r.kt)("strong",{parentName:"p"},"Create new test event")," and provide an\nevent name, for example: ",(0,r.kt)("strong",{parentName:"p"},"updateCase"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the existing event JSON and ",(0,r.kt)("strong",{parentName:"p"},"delete")," it. Paste the modified\nJSON payload you copied from the ",(0,r.kt)("strong",{parentName:"p"},"event-update.json")," file"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image96.png")}),(0,r.kt)("ol",{start:33},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Create")," to save your test event")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"By default, your new test event should be selected in the drop-down\nlist to the left of the Test button."))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image97.png")}),(0,r.kt)("ol",{start:35},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("strong",{parentName:"p"},"Test"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"If successful, the result will be the ",(0,r.kt)("strong",{parentName:"p"},"HTTP 204")," No Content\nsuccess status response code"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image98.png")}),(0,r.kt)("ol",{start:37},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Log in into your Salesforce org and go to the ",(0,r.kt)("strong",{parentName:"p"},"Service Console"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the search box, change the object type to Cases and type Amazon\nConnect Case, then press enter"))),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image99.png")}),(0,r.kt)("ol",{start:39},(0,r.kt)("li",{parentName:"ol"},"You should find 1 case opened by the API user, and the status should\nbe closed")),(0,r.kt)("img",{src:(0,o.Z)("/img/lightning/image100.png")}),(0,r.kt)("ol",{start:40},(0,r.kt)("li",{parentName:"ol"},"You have completed core function validation")),(0,r.kt)("h3",{id:"allow-amazon-connect-to-access-the-sfinvokeapi-lambda-function"},"Allow Amazon Connect to Access the sfInvokeAPI Lambda Function"),(0,r.kt)("p",null,"Once you have validated function, you can use the Amazon Connect console\nto add the sfInvokeAPI Lambda function to your Amazon Connect instance.\nThis automatically adds resource permissions that allow Amazon Connect\nto invoke the function."),(0,r.kt)("h4",{id:"add-the-lambda-function-to-your-amazon-connect-instance"},"Add the Lambda function to your Amazon Connect instance"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In a new browser tab, login to the ",(0,r.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/"},(0,r.kt)("strong",{parentName:"a"},"AWS\nconsole")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Navigate to the ",(0,r.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/connect/home"},"Amazon Connect\nConsole"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select your ",(0,r.kt)("strong",{parentName:"p"},"Instance Alias"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the navigation pane, choose ",(0,r.kt)("strong",{parentName:"p"},"Contact flows"),"."))),(0,r.kt)("img",{src:(0,o.Z)("/img/shared/image01.png")}),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"For ",(0,r.kt)("strong",{parentName:"li"},"AWS Lambda"),", select the function that includes sfInvokeAPI in\nthe name")),(0,r.kt)("img",{src:(0,o.Z)("/img/shared/image02.png")}),(0,r.kt)("ol",{start:6},(0,r.kt)("li",{parentName:"ol"},"Choose ",(0,r.kt)("strong",{parentName:"li"},"Add Lambda Function"),". Confirm that the ARN of the function\nis added under ",(0,r.kt)("strong",{parentName:"li"},"Lambda Functions"),".")),(0,r.kt)("img",{src:(0,o.Z)("/img/shared/image03.png")}),(0,r.kt)("ol",{start:7},(0,r.kt)("li",{parentName:"ol"},"The AWS Lambda function has been added to your Amazon Connect\ninstance.")))}k.isMDXComponent=!0}}]);