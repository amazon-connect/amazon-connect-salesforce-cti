"use strict";(self.webpackChunkamazon_connect_salesforce_cti=self.webpackChunkamazon_connect_salesforce_cti||[]).push([[5117],{3044:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>g,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var n=a(8168),r=(a(6540),a(5680)),o=a(6025);const i={id:"02-guided-setup",title:"Setting Up The CTI Adapter Using Guided Setup"},g=void 0,l={unversionedId:"lightning/installation/02-guided-setup",id:"lightning/installation/02-guided-setup",title:"Setting Up The CTI Adapter Using Guided Setup",description:"In order to navigate to the Guided Setup feature, perform the following steps (NOTE",source:"@site/docs/lightning/02-installation/02-guided-setup.md",sourceDirName:"lightning/02-installation",slug:"/lightning/installation/02-guided-setup",permalink:"/amazon-connect-salesforce-cti/docs/lightning/installation/02-guided-setup",draft:!1,editUrl:"https://github.com/amazon-connect/amazon-connect-salesforce-cti/docs/lightning/02-installation/02-guided-setup.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"02-guided-setup",title:"Setting Up The CTI Adapter Using Guided Setup"},sidebar:"lightning",previous:{title:"Installing the CTI Adapter and Salesforce Lambdas",permalink:"/amazon-connect-salesforce-cti/docs/lightning/installation/01-installation"},next:{title:"Setting Up The CTI Adapter Managed Package Manually",permalink:"/amazon-connect-salesforce-cti/docs/lightning/installation/03-managed-package-manual-setup"}},s={},p=[{value:"Guided Setup Prerequisites",id:"guided-setup-prerequisites",level:2},{value:"Create Named Credential",id:"create-named-credential",level:3},{value:"Create Connected App",id:"create-connected-app",level:3},{value:"Guided Setup Additional Instructions",id:"guided-setup-additional-instructions",level:2},{value:"Retrieve Amazon Connect Instance Url",id:"retrieve-amazon-connect-instance-url",level:3},{value:"Add users to the Call Center",id:"add-users-to-the-call-center",level:3},{value:"Add users to a Permission Set",id:"add-users-to-a-permission-set",level:3},{value:"AC_Administrator",id:"ac_administrator",level:4},{value:"AC_Manager",id:"ac_manager",level:4},{value:"AC_Agent",id:"ac_agent",level:4},{value:"Configure the Toolkit settings",id:"configure-the-toolkit-settings",level:3},{value:"Configure the Scheduler for Batch processing for triggers",id:"configure-the-scheduler-for-batch-processing-for-triggers",level:5},{value:"Create the Softphone Layout",id:"create-the-softphone-layout",level:3},{value:"Retrieve the Salesforce API Version",id:"retrieve-the-salesforce-api-version",level:3},{value:"Setting up the Salesforce API User",id:"setting-up-the-salesforce-api-user",level:3},{value:"Allowing the API user to authenticate using password",id:"allowing-the-api-user-to-authenticate-using-password",level:3},{value:"Setting up the SecretsManager Secret",id:"setting-up-the-secretsmanager-secret",level:3},{value:"Test the Salesforce Lambda Core Functionality",id:"test-the-salesforce-lambda-core-functionality",level:3},{value:"Validate the core functionality",id:"validate-the-core-functionality",level:4},{value:"Allow Amazon Connect to Access the sfInvokeAPI Lambda Function",id:"allow-amazon-connect-to-access-the-sfinvokeapi-lambda-function",level:3},{value:"Add the Lambda function to your Amazon Connect instance",id:"add-the-lambda-function-to-your-amazon-connect-instance",level:4}],m={toc:p},y="wrapper";function c(e){let{components:t,...a}=e;return(0,r.yg)(y,(0,n.A)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("img",{src:(0,o.A)("/img/shared/guidedsetup0.png")}),(0,r.yg)("p",null,"In order to navigate to the Guided Setup feature, perform the following steps (NOTE: If you are not an admin user then you must first add yourself to the AC_Administrator permission set, see ",(0,r.yg)("a",{parentName:"p",href:"./02-guided-setup#add-users-to-a-permission-set"},"here")," for more details):"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Navigate to the Service Console in your Salesforce instance.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Click the drawdown button in the Service Console navigation bar, and select ",(0,r.yg)("strong",{parentName:"p"},"Edit"),"."))),(0,r.yg)("img",{src:(0,o.A)("/img/shared/guidedsetup1.png")}),(0,r.yg)("ol",{start:3},(0,r.yg)("li",{parentName:"ol"},"In the proceeding popup, select ",(0,r.yg)("strong",{parentName:"li"},"Add More Items"),".")),(0,r.yg)("img",{src:(0,o.A)("/img/shared/guidedsetup2.png")}),(0,r.yg)("ol",{start:4},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Click the ",(0,r.yg)("strong",{parentName:"p"},"+")," button next to ",(0,r.yg)("strong",{parentName:"p"},"AC Guided Setup"),", then add the item and ",(0,r.yg)("strong",{parentName:"p"},"save"),".")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the newly added ",(0,r.yg)("strong",{parentName:"p"},"AC Guided Setup")," button in the drawdown menu."))),(0,r.yg)("img",{src:(0,o.A)("/img/shared/guidedsetup3.png")}),(0,r.yg)("h2",{id:"guided-setup-prerequisites"},"Guided Setup Prerequisites"),(0,r.yg)("p",null,"The below sections are linked to from the Guided Setup feature. Only perform the below steps when the\nGuided Setup feature links to them."),(0,r.yg)("h3",{id:"create-named-credential"},"Create Named Credential"),(0,r.yg)("p",null,"See ",(0,r.yg)("a",{parentName:"p",href:"/docs/lightning/installation/01-installation#setting-up-the-executeawsservice-named-credential"},"here")," for instructions on setting up the Named Credential."),(0,r.yg)("h3",{id:"create-connected-app"},"Create Connected App"),(0,r.yg)("p",null,"To get access to the environment, a Connected App must be configured\nwith OAuth settings enabled."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Log in into your Salesforce org and go to ",(0,r.yg)("strong",{parentName:"p"},"Setup"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the ",(0,r.yg)("strong",{parentName:"p"},"Quick Find")," field, type ",(0,r.yg)("strong",{parentName:"p"},"app manager"),", then select ",(0,r.yg)("strong",{parentName:"p"},"App\nManager")," from the results")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the upper right corner, select ",(0,r.yg)("strong",{parentName:"p"},"New Connected App")))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image60.png")}),(0,r.yg)("ol",{start:4},(0,r.yg)("li",{parentName:"ol"},"On the New Connected App form, enter a name for the Connected App,\nsuch as ",(0,r.yg)("strong",{parentName:"li"},"Amazon Connect Integration")," and press tab. This will\npopulate the API Name automatically. Then provide a contact email\naddress")),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image61.png")}),(0,r.yg)("ol",{start:5},(0,r.yg)("li",{parentName:"ol"},"Select the checkbox to ",(0,r.yg)("strong",{parentName:"li"},"Enable OAuth Settings"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image62.png")}),(0,r.yg)("ol",{start:6},(0,r.yg)("li",{parentName:"ol"},"Set the ",(0,r.yg)("strong",{parentName:"li"},"Callback URL")," to your domain url. Find the domain at ",(0,r.yg)("em",{parentName:"li"},"Setup")," -> ",(0,r.yg)("em",{parentName:"li"},"My Domain"),".")),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image293.png")}),(0,r.yg)("ol",{start:7},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the Selected OAuth Scopes section, select the following and add\nthem to the Selected OAuth Scopes:")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Access the identity URL service (id, profile, email, address, phone)")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Manage user data via APIs (api)")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the checkbox for Require Secret for Web Server Flow, and the checkbox for Require Secret For Refresh Token Flow")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"The ",(0,r.yg)("strong",{parentName:"p"},"API (Enable OAuth Settings)")," section should now look like\nthis"))),(0,r.yg)("img",{src:(0,o.A)("/img/shared/guidedsetup4.png")}),(0,r.yg)("ol",{start:12},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Save")," at the bottom of the screen.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Continue")," on the New Connected App page")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"You should now be at the new app's page")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Copy the value for ",(0,r.yg)("strong",{parentName:"p"},"Consumer Key")," to your notepad")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Click to reveal")," next to Consumer Secret and copy the\nvalue to your notepad")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"At the top of the detail page, select ",(0,r.yg)("strong",{parentName:"p"},"Manage"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"On the Connected App Detail page, select the ",(0,r.yg)("strong",{parentName:"p"},"Edit Policies"),"\nbutton")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Set Permitted Users to ",(0,r.yg)("strong",{parentName:"p"},"Admin approved users are pre-authorized"),"\nand choose OK on the pop-up dialog")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Set IP Relaxation to ",(0,r.yg)("strong",{parentName:"p"},"Relax IP restrictions"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"The OAuth Policies section should now look like the following"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image65.png")}),(0,r.yg)("ol",{start:22},(0,r.yg)("li",{parentName:"ol"},"Select ",(0,r.yg)("strong",{parentName:"li"},"Save"))),(0,r.yg)("h2",{id:"guided-setup-additional-instructions"},"Guided Setup Additional Instructions"),(0,r.yg)("p",null,"The below sections are linked to from the Guided Setup feature. Only perform the below steps when the\nGuided Setup feature links to them."),(0,r.yg)("h3",{id:"retrieve-amazon-connect-instance-url"},"Retrieve Amazon Connect Instance Url"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Navigate to the ",(0,r.yg)("a",{parentName:"p",href:"https://console.aws.amazon.com/connect/home"},"Amazon Connect\nConsole"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select your Instance Alias")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"On the Overview page for your instance, copy the Login URL\n(if your Amazon Connect instance uses the ",(0,r.yg)("inlineCode",{parentName:"p"},"https://(instancename).awsapps.com/connect/login"),'\ndomain, then remove everything after ".com"):'))),(0,r.yg)("img",{src:(0,o.A)("/img/shared/image04.png")}),(0,r.yg)("h3",{id:"add-users-to-the-call-center"},"Add users to the Call Center"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Log in into your Salesforce org and go to ",(0,r.yg)("strong",{parentName:"p"},"Setup"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the ",(0,r.yg)("strong",{parentName:"p"},"Quick Find")," field, enter ",(0,r.yg)("strong",{parentName:"p"},"Call Center"),", then select\n",(0,r.yg)("strong",{parentName:"p"},"Call Centers")," from the result list"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image28.png")}),(0,r.yg)("ol",{start:3},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"If you see the ",(0,r.yg)("strong",{parentName:"p"},"Say Hello to Salesforce Call Center")," page, select\n",(0,r.yg)("strong",{parentName:"p"},"Continue"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"AC Lightning Adapter")))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image29.png")}),(0,r.yg)("ol",{start:5},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"On the ",(0,r.yg)("strong",{parentName:"p"},"AC Lightning Adapter")," detail page, select ",(0,r.yg)("strong",{parentName:"p"},"Edit"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"On the ",(0,r.yg)("strong",{parentName:"p"},"AC Lightning Adapter: Manage Users")," page, select ",(0,r.yg)("strong",{parentName:"p"},"Add\nMore Users"),".")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Set filters (if desired) and then choose ",(0,r.yg)("strong",{parentName:"p"},"Find"),".")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the checkbox next to the user to add, then choose ",(0,r.yg)("strong",{parentName:"p"},"Add to\nCall Center"),"."))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image30.png")}),(0,r.yg)("ol",{start:9},(0,r.yg)("li",{parentName:"ol"},"Repeat the steps to add more users.")),(0,r.yg)("h3",{id:"add-users-to-a-permission-set"},"Add users to a Permission Set"),(0,r.yg)("p",null,"All users must be assigned the required permission set to access\nSalesforce metadata. The Amazon Connect CTI Adapter includes\nPermission Sets-- one for agents, one for managers, one for\nadministrators, and a few for specific features, that grant users\nthe appropriate access for their role. More information on assigning\nuser permissions can be found in the ",(0,r.yg)("a",{parentName:"p",href:"https://help.salesforce.com/articleView?id=perm_sets_mass_assign.htm&type=5"},"Salesforce help\ndocumentation"),"."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Log in into your Salesforce org and go to ",(0,r.yg)("strong",{parentName:"p"},"Setup"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In ",(0,r.yg)("strong",{parentName:"p"},"Quick Find"),", enter ",(0,r.yg)("strong",{parentName:"p"},"Permission")," and select ",(0,r.yg)("strong",{parentName:"p"},"Permission\nSets")," from the results")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Choose ",(0,r.yg)("strong",{parentName:"p"},"AC_Administrator"),", ",(0,r.yg)("strong",{parentName:"p"},"AC_Agent")," or ",(0,r.yg)("strong",{parentName:"p"},"AC_Manager")," as\nappropriate for the user(s)"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image12.png")}),(0,r.yg)("ol",{start:4},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Choose ",(0,r.yg)("strong",{parentName:"p"},"Manage Assignments"),".")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Choose ",(0,r.yg)("strong",{parentName:"p"},"Add Assignments"),".")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the users to assign the permissions, then choose ",(0,r.yg)("strong",{parentName:"p"},"Assign"),"."))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image13.png")}),(0,r.yg)("ol",{start:7},(0,r.yg)("li",{parentName:"ol"},"Repeat these steps as needed for all users")),(0,r.yg)("h4",{id:"ac_administrator"},"AC_Administrator"),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image14.png")}),(0,r.yg)("h4",{id:"ac_manager"},"AC_Manager"),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image15.png")}),(0,r.yg)("h4",{id:"ac_agent"},"AC_Agent"),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image16.png")}),(0,r.yg)("h3",{id:"configure-the-toolkit-settings"},"Configure the Toolkit settings"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Navigate to ",(0,r.yg)("strong",{parentName:"li"},"Setup")," then in type ",(0,r.yg)("strong",{parentName:"li"},"Custom Settings")," in Quick\nFind")),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image31.png")}),(0,r.yg)("ol",{start:2},(0,r.yg)("li",{parentName:"ol"},"Next to the Toolkit for Amazon Connect custom setting, choose\n",(0,r.yg)("strong",{parentName:"li"},"Manage"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image32.png")}),(0,r.yg)("ol",{start:3},(0,r.yg)("li",{parentName:"ol"},"Select ",(0,r.yg)("strong",{parentName:"li"},"New"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image33.png")}),(0,r.yg)("ol",{start:4},(0,r.yg)("li",{parentName:"ol"},"On the following page, provide the URL to your Amazon Connect\ninstance. This value can be found in your Amazon Connect console.")),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/amazonconnectconsoleaccessurl.png")}),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image34.png")}),(0,r.yg)("ol",{start:5},(0,r.yg)("li",{parentName:"ol"},"You will also see the option to enable and disable certain\ntriggers in the package, which you can configure to meet your needs. You\ncan change these whenever you would like to. For more details, see below")),(0,r.yg)("p",null,"These are options we provide that allow you to toggle certain functionality in the adapter."),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"CCA Case Trigger - This trigger looks for any ContactChannelAnalytics records that could be related to a updated/inserted Case, and creates a relationsihp between the two records. This trigger uses batching to process the update requests."),(0,r.yg)("li",{parentName:"ul"},"CCA Contact Trigger - This trigger looks for any ContactChannelAnalytics records that could be related to a updated/inserted Contact, and creates a relationsihp between the two records. This trigger uses batching to process the update requests."),(0,r.yg)("li",{parentName:"ul"},"Case Contact CCA Trigger - This trigger looks for any Case/Contact records that could be related to an updated/inserted ContactChannelAnalytics record, and creates a relationsihp between the records."),(0,r.yg)("li",{parentName:"ul"},"Task Trigger - This trigger creates a ContactChannel record for any inserted/updated task that with a ",(0,r.yg)("inlineCode",{parentName:"li"},"CallObject")," field that does not currently have a ContactChannel record created before.")),(0,r.yg)("ol",{start:6},(0,r.yg)("li",{parentName:"ol"},"Select ",(0,r.yg)("strong",{parentName:"li"},"Save"))),(0,r.yg)("h5",{id:"configure-the-scheduler-for-batch-processing-for-triggers"},"Configure the Scheduler for Batch processing for triggers"),(0,r.yg)("p",null,"The execution time for triggers that run in batches (refer the list above) can be managed using a cron-job scheduler in CTI Adapter. The scheduler allows you to configure the frequency at which triggers will execute in batches. By default, this job will run every hour. It's important to note that Salesforce's Lightning Platform has existing limits on lightning platforms, which you should consider when scheduling your apex batch jobs to avoid exceeding these constraints. For instance, there is a maximum limit of 100 concurrent Apex classes that can be scheduled (please refer to the ",(0,r.yg)("a",{parentName:"p",href:"https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_gov_limits.htm#in_topic_non_transactional_gov_limits_section"},"Salesforce documentation")," for the latest limits). Therefore, if you anticipate more than 100 batch Apex executions per hour to fulfill all the associations from the triggers, you may need to increase the batch execution frequency accordingly. In order to setup the processing of these jobs, follow the below steps: "),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"From the ",(0,r.yg)("em",{parentName:"p"},"Setup"),", go to ",(0,r.yg)("em",{parentName:"p"},"Object Manager"),", and click on ",(0,r.yg)("em",{parentName:"p"},"AC CTI Adapter"),". "),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/cti_adapter_object.png")})),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"From the left navigation menu, select ",(0,r.yg)("em",{parentName:"p"},"Buttons, Links, and Actions")," and click on ",(0,r.yg)("em",{parentName:"p"},"New Action"),"."),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/create_new_action_one .png")})),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the Action Type, select ",(0,r.yg)("em",{parentName:"p"},"Lightning Component"),". A drop down for lightning component will appear from which, select ",(0,r.yg)("inlineCode",{parentName:"p"},"amazonconnect:AC_ToggleScheduleBatchJob"),"."),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/create_new_action_two.png")})),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Provide the Label to the action as ",(0,r.yg)("inlineCode",{parentName:"p"},"Schedule Batch Job")," and click on ",(0,r.yg)("em",{parentName:"p"},"Save"),".")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Click the ",(0,r.yg)("em",{parentName:"p"},"Page Layouts")," and select the current layout used for displaying CTI Adapter. The default layout provided currently is ",(0,r.yg)("em",{parentName:"p"},"AC CTI Adapter Layout - August 2020"),". ")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the page layout edit view, under ",(0,r.yg)("em",{parentName:"p"},"Salesforce Mobile and Lightning Experience Actions"),", enable the option to ",(0,r.yg)("em",{parentName:"p"},"override the predefined actions"),"."),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/override_lightning_action.png")})),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"From the ",(0,r.yg)("em",{parentName:"p"},"Mobile and Lightning Actions"),", drag the newly created action to the lightning experience actions section, and save the layout."),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/drag_scheduler.png")})),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the ",(0,r.yg)("em",{parentName:"p"},"Service Console"),", under the ",(0,r.yg)("em",{parentName:"p"},"AC CTI Adapters")," from the menu, choose the ",(0,r.yg)("inlineCode",{parentName:"p"},"ACLightningAdapter")," value been used in your Salesforce environment.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"From the drop down on the top right of the Cti Adapter, click on the newly created action ",(0,r.yg)("em",{parentName:"p"},"Schedule Batch Job"),"."),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/toggle_scheduler.png")})),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"A pop up will open that allows you to set the schedule for the batch jobs to run. If required, you can use any available cron generator (such as ",(0,r.yg)("a",{parentName:"p",href:"https://crontab.cronhub.io/"},"this"),") to create a cron job schedule.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Finally, click on ",(0,r.yg)("em",{parentName:"p"},"Start Scheduled Job For Batching")," to save the schedule and start the batch jobs."))),(0,r.yg)("h3",{id:"create-the-softphone-layout"},"Create the Softphone Layout"),(0,r.yg)("p",null,"The softphone layout settings will tell the console what resources are\navailable for screenpop by default and what to do under different match\nconditions."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Log in into your Salesforce org and go to ",(0,r.yg)("strong",{parentName:"p"},"Setup"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the ",(0,r.yg)("strong",{parentName:"p"},"Quick Find")," box, type ",(0,r.yg)("strong",{parentName:"p"},"Softphone"),", then choose\n",(0,r.yg)("strong",{parentName:"p"},"Softphone Layouts")," from the results")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"If you are presented with the Get Started message, choose\n",(0,r.yg)("strong",{parentName:"p"},"Continue"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"On the Softphone Layouts page, choose ",(0,r.yg)("strong",{parentName:"p"},"New")))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image35.png")}),(0,r.yg)("ol",{start:5},(0,r.yg)("li",{parentName:"ol"},"Enter a name for the layout, such as ",(0,r.yg)("strong",{parentName:"li"},"AmazonConnectDefault"),", then\nselect the ",(0,r.yg)("strong",{parentName:"li"},"Is Default Layout")," checkbox.")),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image36.png")}),(0,r.yg)("ol",{start:6},(0,r.yg)("li",{parentName:"ol"},"Expand ",(0,r.yg)("strong",{parentName:"li"},"Display these salesforce.com objects")," and select objects\nthat CTI Connector should be able to search, for a screen-pop query.\nIn this example, Case has been added to the default selection,\nallowing search and screen-pop by CaseID.")),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image37.png")}),(0,r.yg)("ol",{start:7},(0,r.yg)("li",{parentName:"ol"},"If desired, configure the search behavior to your requirements")),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image38.png")}),(0,r.yg)("ol",{start:8},(0,r.yg)("li",{parentName:"ol"},"Additionally, validate the Screen Pop settings. Please note that the\ndefault behavior is to not pop a screen if there is more than one\nresult")),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image39.png")}),(0,r.yg)("ol",{start:9},(0,r.yg)("li",{parentName:"ol"},"Once you have configured the search behavior, choose ",(0,r.yg)("strong",{parentName:"li"},"Save"))),(0,r.yg)("h3",{id:"retrieve-the-salesforce-api-version"},"Retrieve the Salesforce API Version"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Log in into your Salesforce org and go to ",(0,r.yg)("strong",{parentName:"p"},"Setup"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the ",(0,r.yg)("strong",{parentName:"p"},"Quick Find")," field, type ",(0,r.yg)("strong",{parentName:"p"},"apex"),", then select ",(0,r.yg)("strong",{parentName:"p"},"Apex\nClasses")," from the results"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image56.png")}),(0,r.yg)("ol",{start:3},(0,r.yg)("li",{parentName:"ol"},"Select New")),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image57.png")}),(0,r.yg)("ol",{start:4},(0,r.yg)("li",{parentName:"ol"},"Select the Version Settings tab")),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image58.png")}),(0,r.yg)("ol",{start:5},(0,r.yg)("li",{parentName:"ol"},"Note the Salesforce.com API version in your notepad. The pattern of this value is ",(0,r.yg)("inlineCode",{parentName:"li"},"vXX.X"),".")),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image59.png")}),(0,r.yg)("h3",{id:"setting-up-the-salesforce-api-user"},"Setting up the Salesforce API User"),(0,r.yg)("p",null,"The Lambda functions authenticate with Salesforce via user credentials.\nIt is a common practice to create an API user account for this purpose."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Log in into your Salesforce org and go to ",(0,r.yg)("strong",{parentName:"p"},"Setup"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the ",(0,r.yg)("strong",{parentName:"p"},"Quick Find")," field, type ",(0,r.yg)("strong",{parentName:"p"},"profiles"),", then select\n",(0,r.yg)("strong",{parentName:"p"},"Profiles")," from the results")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select New Profile"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image66.png")}),(0,r.yg)("ol",{start:4},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Provide a Profile Name, such as ",(0,r.yg)("strong",{parentName:"p"},"API_ONLY"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"From the ",(0,r.yg)("strong",{parentName:"p"},"Existing Profile")," dropdown, select ",(0,r.yg)("strong",{parentName:"p"},"System Administrator"),"\n",(0,r.yg)("strong",{parentName:"p"},"NOTE:")," You\\'re advised to use a full Salesforce License for the\nuser to be able to set the below permissions and have full access to\navoid any other errors."))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image67.png")}),(0,r.yg)("ol",{start:6},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Save")," to create the new profile")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Once the new profile page opens, scroll down to and select the ",(0,r.yg)("strong",{parentName:"p"},"System Permissions")," section"))),(0,r.yg)("img",{src:(0,o.A)("/img/shared/usersetup1.png")}),(0,r.yg)("ol",{start:8},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"When the next page opens, select ",(0,r.yg)("strong",{parentName:"p"},"edit"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Make sure the ",(0,r.yg)("strong",{parentName:"p"},"Lightning Experience User")," option is unselected"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image290.png")}),(0,r.yg)("ol",{start:10},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Save"),", and confirm the changes")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Go back to the Profile Overview, scroll down, and select ",(0,r.yg)("strong",{parentName:"p"},"Password Policies")))),(0,r.yg)("img",{src:(0,o.A)("/img/shared/usersetup2.png")}),(0,r.yg)("ol",{start:12},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Edit"),".")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Set ",(0,r.yg)("strong",{parentName:"p"},"User passwords expire in")," to ",(0,r.yg)("strong",{parentName:"p"},"Never expires")," NOTE: Failure to this may lead to production outages.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Save"),".")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the ",(0,r.yg)("strong",{parentName:"p"},"Quick Find")," field, type ",(0,r.yg)("strong",{parentName:"p"},"connect"),", then select ",(0,r.yg)("strong",{parentName:"p"},"Manage\nConnected Apps")," from the results"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image69.png")}),(0,r.yg)("ol",{start:16},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the app you have created earlier, ",(0,r.yg)("strong",{parentName:"p"},"Amazon Connect\nIntegration"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the profiles section, select ",(0,r.yg)("strong",{parentName:"p"},"Manage Profiles"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the new ",(0,r.yg)("strong",{parentName:"p"},"API_Only")," profile that you just created")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Save")," at the bottom of the page")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the ",(0,r.yg)("strong",{parentName:"p"},"Quick Find")," field, type ",(0,r.yg)("strong",{parentName:"p"},"users")," then select ",(0,r.yg)("strong",{parentName:"p"},"Users"),"\nfrom the results")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select New User")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Set the required fields as:"),(0,r.yg)("p",{parentName:"li"},"a.  Last Name: apiuser"),(0,r.yg)("p",{parentName:"li"},"b.  Alias: apiuser"),(0,r.yg)("p",{parentName:"li"},"c.  Email: provide a valid email address"),(0,r.yg)("p",{parentName:"li"},"d.  Username: apiuser@<yoursalesforcedomain",">",".com"),(0,r.yg)("p",{parentName:"li"},"e.  Nickname: apiuser")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"On the right-hand side, set ",(0,r.yg)("strong",{parentName:"p"},"User License")," to ",(0,r.yg)("strong",{parentName:"p"},"Salesforce"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Set Profile to API_ONLY")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Choose ",(0,r.yg)("strong",{parentName:"p"},"Save"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In ",(0,r.yg)("strong",{parentName:"p"},"Quick Find"),', search for "Permission Sets". Select the ',(0,r.yg)("strong",{parentName:"p"},"AC_Administrator")," permission set."))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/lambda-install-0.png")}),(0,r.yg)("ol",{start:27},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Manage Assignments"),". Add the apiuser you just created to the permission set.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"A confirmation email with an ",(0,r.yg)("strong",{parentName:"p"},"activation link")," will be sent to the\nemail address provided. Choose the link to activate your user and\nset their password")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Fill out the form to set a password for the API user")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Change Password"),". The API user will log into the\nSalesforce Classic view")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Access the API user's personal settings by selecting the username in\nthe top right corner, then choose ",(0,r.yg)("strong",{parentName:"p"},"My Settings")))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image70.png")}),(0,r.yg)("ol",{start:32},(0,r.yg)("li",{parentName:"ol"},"In the ",(0,r.yg)("strong",{parentName:"li"},"Quick Find")," field, type ",(0,r.yg)("strong",{parentName:"li"},"security")," then select ",(0,r.yg)("strong",{parentName:"li"},"Reset\nMy Security Token")," from the results")),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image71.png")}),(0,r.yg)("ol",{start:33},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Reset Security Token"),". Your security token will be emailed\nto you")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Copy the security token from the email to your notepad"))),(0,r.yg)("h3",{id:"allowing-the-api-user-to-authenticate-using-password"},"Allowing the API user to authenticate using password"),(0,r.yg)("p",null,"The api user created above authenticates using username-password flow in Salesforce. This flow needs to be unblocked and to do that, go to ",(0,r.yg)("em",{parentName:"p"},"Setup")," and in the Quick Find box, search for ",(0,r.yg)("strong",{parentName:"p"},"OAuth and OpenID Connect Settings"),". After that, make sure that the toggles for ",(0,r.yg)("strong",{parentName:"p"},"Allow OAuth Username-Password Flows")," and ",(0,r.yg)("strong",{parentName:"p"},"Allow OAuth User-Agent Flows")," are turned ON, as shown in below image."),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image292.png")}),(0,r.yg)("h3",{id:"setting-up-the-secretsmanager-secret"},"Setting up the SecretsManager Secret"),(0,r.yg)("p",null,"To ensure that your Salesforce credentials are secure, the Lambdas\nrequire that the credentials are stored in AWS Secrets Manager. AWS\nSecrets Manager is a highly secure service that helps you store and\nretrieve secrets."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In a new browser tab, login to the AWS console")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Make sure you are in the same region as your Amazon Connect\ninstance. You can set the region by expanding the region selector in\nthe upper right and choosing the region"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image75.png")}),(0,r.yg)("ol",{start:3},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Navigate to the ",(0,r.yg)("a",{parentName:"p",href:"https://console.aws.amazon.com/secretsmanager/home"},"Secrets Manager\nconsole"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Secrets"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Store a new secret"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Other types of secrets"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Make sure ",(0,r.yg)("strong",{parentName:"p"},"Secret key/value")," is selected")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Enter key value pairs that match the following:"),(0,r.yg)("p",{parentName:"li"},"a.  ",(0,r.yg)("strong",{parentName:"p"},"Key:")," Password, ",(0,r.yg)("strong",{parentName:"p"},"Value:")," the password for the API user that\nyou configured in the previous section"),(0,r.yg)("p",{parentName:"li"},"b.  ",(0,r.yg)("strong",{parentName:"p"},"Key:")," ConsumerKey, ",(0,r.yg)("strong",{parentName:"p"},"Value:")," the Consumer Key for the\nConnected App you created in the previous section"),(0,r.yg)("p",{parentName:"li"},"c.  ",(0,r.yg)("strong",{parentName:"p"},"Key:")," ConsumerSecret, ",(0,r.yg)("strong",{parentName:"p"},"Value:")," the Consumer Secret for the\nConnected App you created in the previous section"),(0,r.yg)("p",{parentName:"li"},"d.  ",(0,r.yg)("strong",{parentName:"p"},"Key:")," AccessToken, ",(0,r.yg)("strong",{parentName:"p"},"Value:")," this is the access token for\nthe API user that you configured in the previous section")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"For the encryption key, click ",(0,r.yg)("strong",{parentName:"p"},"Add new key"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Create Key"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Make sure key type is set to ",(0,r.yg)("strong",{parentName:"p"},"symmetric"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Give your key an ",(0,r.yg)("strong",{parentName:"p"},"alias"),", like\n",(0,r.yg)("em",{parentName:"p"},"SalesforceCredentialsSecretsManagerKey"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Click Next")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select administrators you want to have access permission to change\nthe key policy. Make sure you are being as restrictive as possible")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Click Next")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the users and roles you want to have access to the Salesforce\ncredentials in Secrets Manager. Make sure you are being as\nrestrictive as possible")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Click Next")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Click Finish")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Click on the managed key that you just created (which is\n",(0,r.yg)("em",{parentName:"p"},"SalesforceCredentialsSecretsManagerKey")," in this case).")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Note down the ARN. This is SalesforceCredentialsKMSKeyARN that will\nbe used later when installing the Amazon Connect Salesforce Lambda\npackage.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Navigate back to the Secrets Manager setup tab")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the key you just created"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image76.png")}),(0,r.yg)("ol",{start:23},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Click Next")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Give your secret a name, like ",(0,r.yg)("em",{parentName:"p"},"SalesforceCredentials"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Click Next")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Make sure ",(0,r.yg)("strong",{parentName:"p"},"automatic rotation")," is disabled.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Click Next")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Click Store")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the secret you just created, and copy the Secret ARN"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image77.png")}),(0,r.yg)("h3",{id:"test-the-salesforce-lambda-core-functionality"},"Test the Salesforce Lambda Core Functionality"),(0,r.yg)("p",null,"The package provides a core Lambda function (sfInvokeAPI) that supports\nmultiple operations, like lookup, create and update. For the initial\nvalidation, sample events are provided within the function. Validating\nthis function provides a good check that the installation and\nconfiguration is correct."),(0,r.yg)("p",null,"Validating the lambda functions requires the use of test events to\nsimulate data coming into the function as it would in a typical\ndeployment. Each function has a set of test event samples included to\nmake validation easier."),(0,r.yg)("h4",{id:"validate-the-core-functionality"},"Validate the core functionality"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In a new browser tab, login to the ",(0,r.yg)("a",{parentName:"p",href:"https://console.aws.amazon.com/"},(0,r.yg)("strong",{parentName:"a"},"AWS\nconsole")))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Open the ",(0,r.yg)("a",{parentName:"p",href:"https://console.aws.amazon.com/lambda/home"},"AWS Lambda\nConsole"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the Filter field, enter sfInvokeAPI and press enter, this will\nfilter your list out to the core function that we just installed"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image82.png")}),(0,r.yg)("ol",{start:4},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the ",(0,r.yg)("strong",{parentName:"p"},"function name.")," First, we will validate a phone number\nlookup.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the Environment pane, double-click the event-phoneLookup.json\nfile"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image83.png")}),(0,r.yg)("ol",{start:6},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"The test even JSON will open in the Lambda editor")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Modify the value for sf_phone to match the phone number of the test\ncontact you created when you setup the CTI adapter or for any valid\ncontact in your Salesforce org\\\nNOTE: The phone number must be in ",(0,r.yg)("a",{parentName:"p",href:"https://docs.aws.amazon.com/connect/latest/adminguide/amazon-connect-contact-control-panel.html#international-calls-ccp"},"E.164\nformat")))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image84.png")}),(0,r.yg)("ol",{start:8},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the entire JSON event and copy it, then close the\n",(0,r.yg)("strong",{parentName:"p"},"event-phoneLookup.json")," tab.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the top-right corner, select drop-down arrow next to ",(0,r.yg)("strong",{parentName:"p"},"Test")," and\nchoose ",(0,r.yg)("strong",{parentName:"p"},"Configure test events")))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image85.png")}),(0,r.yg)("ol",{start:10},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the radio button for ",(0,r.yg)("strong",{parentName:"p"},"Create new test event")," and provide an\nevent name, for example: ",(0,r.yg)("strong",{parentName:"p"},"phoneLookup"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the existing event JSON and ",(0,r.yg)("strong",{parentName:"p"},"delete")," it. Paste the modified\nJSON payload you copied from the ",(0,r.yg)("strong",{parentName:"p"},"event-phoneLookup.json")," file"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image86.png")}),(0,r.yg)("ol",{start:12},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Create")," to save your test event")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"By default, your new test event should be selected in the drop-down\nlist to the left of the Test button."))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image87.png")}),(0,r.yg)("ol",{start:14},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Test"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},'If successful, the result will contain fields defined in "sf_fields"\nparameter in the invocation event'))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image88.png")}),(0,r.yg)("ol",{start:16},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Copy the value for the ",(0,r.yg)("strong",{parentName:"p"},"Id")," key in the response. Next, we are\ngoing to use that Id to create a Case in Salesforce.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the Environment pane, double-click the ",(0,r.yg)("strong",{parentName:"p"},"event-create.json"),"\nfile. Replace the existing ContactId value with the ID value you\ncopied previously."))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image89.png")}),(0,r.yg)("ol",{start:18},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the entire JSON event and copy it, then close the\n",(0,r.yg)("strong",{parentName:"p"},"event-create.json")," tab.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the top-right corner, select drop-down arrow next to ",(0,r.yg)("strong",{parentName:"p"},"Test")," and\nchoose ",(0,r.yg)("strong",{parentName:"p"},"Configure test events")))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image90.png")}),(0,r.yg)("ol",{start:20},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the radio button for ",(0,r.yg)("strong",{parentName:"p"},"Create new test event")," and provide an\nevent name, for example: ",(0,r.yg)("strong",{parentName:"p"},"createCase"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the existing event JSON and ",(0,r.yg)("strong",{parentName:"p"},"delete")," it. Paste the modified\nJSON payload you copied from the ",(0,r.yg)("strong",{parentName:"p"},"event-create.json")," file"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image91.png")}),(0,r.yg)("ol",{start:22},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Create")," to save your test event")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"By default, your new test event should be selected in the drop-down\nlist to the left of the Test button."))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image92.png")}),(0,r.yg)("ol",{start:24},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Test"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"If successful, the result will contain the Case Id"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image93.png")}),(0,r.yg)("ol",{start:26},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Copy the value for the ",(0,r.yg)("strong",{parentName:"p"},"Id")," key in the response.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"When we created the case, the ",(0,r.yg)("strong",{parentName:"p"},"Status was set to New")," and the\n",(0,r.yg)("strong",{parentName:"p"},"Priority to Low"),". We are going to use the update operation to\nclose the case.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the Environment pane, double-click the ",(0,r.yg)("strong",{parentName:"p"},"event-update.json"),' file\nand replace the existing Case Id in "sf_id" parameter with the new\none you copied from the last test result'))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image94.png")}),(0,r.yg)("ol",{start:29},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the ",(0,r.yg)("strong",{parentName:"p"},"entire JSON event")," and copy it, then close the\n",(0,r.yg)("strong",{parentName:"p"},"event-update.json")," tab.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the top-right corner, select drop-down arrow next to ",(0,r.yg)("strong",{parentName:"p"},"Test")," and\nchoose **Configure test events"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image95.png")}),(0,r.yg)("ol",{start:31},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the radio button for ",(0,r.yg)("strong",{parentName:"p"},"Create new test event")," and provide an\nevent name, for example: ",(0,r.yg)("strong",{parentName:"p"},"updateCase"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select the existing event JSON and ",(0,r.yg)("strong",{parentName:"p"},"delete")," it. Paste the modified\nJSON payload you copied from the ",(0,r.yg)("strong",{parentName:"p"},"event-update.json")," file"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image96.png")}),(0,r.yg)("ol",{start:33},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Create")," to save your test event")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"By default, your new test event should be selected in the drop-down\nlist to the left of the Test button."))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image97.png")}),(0,r.yg)("ol",{start:35},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select ",(0,r.yg)("strong",{parentName:"p"},"Test"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"If successful, the result will be the ",(0,r.yg)("strong",{parentName:"p"},"HTTP 204")," No Content\nsuccess status response code"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image98.png")}),(0,r.yg)("ol",{start:37},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Log in into your Salesforce org and go to the ",(0,r.yg)("strong",{parentName:"p"},"Service Console"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the search box, change the object type to Cases and type Amazon\nConnect Case, then press enter"))),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image99.png")}),(0,r.yg)("ol",{start:39},(0,r.yg)("li",{parentName:"ol"},"You should find 1 case opened by the API user, and the status should\nbe closed")),(0,r.yg)("img",{src:(0,o.A)("/img/lightning/image100.png")}),(0,r.yg)("ol",{start:40},(0,r.yg)("li",{parentName:"ol"},"You have completed core function validation")),(0,r.yg)("h3",{id:"allow-amazon-connect-to-access-the-sfinvokeapi-lambda-function"},"Allow Amazon Connect to Access the sfInvokeAPI Lambda Function"),(0,r.yg)("p",null,"Once you have validated function, you can use the Amazon Connect console\nto add the sfInvokeAPI Lambda function to your Amazon Connect instance.\nThis automatically adds resource permissions that allow Amazon Connect\nto invoke the function."),(0,r.yg)("h4",{id:"add-the-lambda-function-to-your-amazon-connect-instance"},"Add the Lambda function to your Amazon Connect instance"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In a new browser tab, login to the ",(0,r.yg)("a",{parentName:"p",href:"https://console.aws.amazon.com/"},(0,r.yg)("strong",{parentName:"a"},"AWS\nconsole")))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Navigate to the ",(0,r.yg)("a",{parentName:"p",href:"https://console.aws.amazon.com/connect/home"},"Amazon Connect\nConsole"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Select your ",(0,r.yg)("strong",{parentName:"p"},"Instance Alias"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"In the navigation pane, choose ",(0,r.yg)("strong",{parentName:"p"},"Contact flows"),"."))),(0,r.yg)("img",{src:(0,o.A)("/img/shared/image01.png")}),(0,r.yg)("ol",{start:5},(0,r.yg)("li",{parentName:"ol"},"Scroll down to the ",(0,r.yg)("strong",{parentName:"li"},"AWS Lambda")," section, and select the function that includes sfInvokeAPI in\nthe name")),(0,r.yg)("img",{src:(0,o.A)("/img/shared/image02.png")}),(0,r.yg)("ol",{start:6},(0,r.yg)("li",{parentName:"ol"},"Choose ",(0,r.yg)("strong",{parentName:"li"},"Add Lambda Function"),". Confirm that the ARN of the function\nis added under ",(0,r.yg)("strong",{parentName:"li"},"Lambda Functions"),".")),(0,r.yg)("img",{src:(0,o.A)("/img/shared/image03.png")}),(0,r.yg)("ol",{start:7},(0,r.yg)("li",{parentName:"ol"},"The AWS Lambda function has been added to your Amazon Connect\ninstance.")))}c.isMDXComponent=!0},5680:(e,t,a)=>{a.d(t,{xA:()=>p,yg:()=>h});var n=a(6540);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function g(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),s=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=s(e.components);return n.createElement(l.Provider,{value:t},e.children)},m="mdxType",y={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=g(e,["components","mdxType","originalType","parentName"]),m=s(a),c=r,h=m["".concat(l,".").concat(c)]||m[c]||y[c]||o;return a?n.createElement(h,i(i({ref:t},p),{},{components:a})):n.createElement(h,i({ref:t},p))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=c;var g={};for(var l in t)hasOwnProperty.call(t,l)&&(g[l]=t[l]);g.originalType=e,g[m]="string"==typeof e?e:r,i[1]=g;for(var s=2;s<o;s++)i[s]=a[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"}}]);